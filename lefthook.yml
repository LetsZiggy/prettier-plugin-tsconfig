$schema: 'https://raw.githubusercontent.com/evilmartians/lefthook/master/schema.json'

commit-msg:
  commands:
    go-gitlint:
      run: >
        go-gitlint
        --path="$(git rev-parse --show-toplevel)"
        --msg-file="$(git rev-parse --show-toplevel)/{1}"
        --since=$(date +"%Y-%m-%d")
        --max-parents=1
        --subject-regex="(?:^Initial commit$)|(?:^(?:fixup! )?(?:(?:feat)|(?:fix)|(?:docs)|(?:style)|(?:refactor)|(?:perf)|(?:test)|(?:build)|(?:ci)|(?:chore)|(?:revert))(?:\([^()A-Z\r\n]+\))?: (?:(?:LICENSE)|(?:README)|(?:[^A-Z\r\n ][^A-Z\r\n]+[^. ]))$)"

pre-commit:
  # parallel: true
  commands:
    ruff:
      glob: '{.[!.],}*.py'
      run: |
        echo -e "staged_files >>> {staged_files}\n";
        uv --project webscrape-tsconfig run ruff format {staged_files};
        uv --project webscrape-tsconfig run ruff check --fix {staged_files};
      stage_fixed: true
    eslint:
      glob: '{.[!.],}*.{js,ts}'
      run: |
        GIT_ROOT_PATH=$(git rev-parse --show-toplevel);
        STAGED_FILES_ABS_PATH=$(echo "{staged_files}" | sed -E -e "s,((^[^ ]+)|([^ ]+)),$GIT_ROOT_PATH/\1,g");
        pnpm --dir plugin run fix:eslint $STAGED_FILES_ABS_PATH;
      stage_fixed: true
    prettier-json:
      glob: '{.[!.],}*.json'
      run: |
        GIT_ROOT_PATH=$(git rev-parse --show-toplevel);
        STAGED_FILES_ABS_PATH=$(echo "{staged_files}" | sed -E -e "s,((^[^ ]+)|([^ ]+)),$GIT_ROOT_PATH/\1,g");
        pnpm --dir plugin run fix:prettier $STAGED_FILES_ABS_PATH;
      stage_fixed: true
